\documentclass{acmsiggraph}               % final

%% These two line bring in essential packages: ``mathptmx'' for Type 1
%% typefaces, and ``graphicx'' for inclusion of EPS figures.

\usepackage{graphicx}
\usepackage{url}
\usepackage{times}
\usepackage{ifpdf}

%% Redundant.
%% Paper title.

\title{C++ News Server and Client Implementation}

\author{Gustaf Waldemarson\thanks{e-mail: ada09gwa@student.lu.se}
\and Martin Trasteby\thanks{e-mail: atf09dtr@student.lu.se}
\and Erik Jansson\thanks{ada09eja@student.lu.se}
\and Tommy Olofsson \thanks{ada09tol@student.lu.se}}
\affiliation{Faculty of Engineering (LTH), Lund University \\ Sweden}


%% Keywords that describe your work.
\keywords{C++, C, News Server, Database, Remote Connections}


\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}

%%%%%% START OF THE PAPER %%%%%%
\begin{document}

\ifpdf
  \DeclareGraphicsExtensions{.jpg,.pdf,.mps,.png}
\else
  \DeclareGraphicsExtensions{.eps}
\fi

\input{title_page.tex}

% \maketitle

\begin{abstract}
This report details an implementation of a news server with a fixed
communication protocol, as well as a client using this protocol in
order to retrieve or create news on the server. The articles and
groupings of articles called "news groups" are stored in two different
versions of a database -- one stores the information on the primary
memory, while another stores them on the hard drive. The client is a
terminal application.

\end{abstract}
\keywordlist

\section{Trace Of Interaction}
Due to the simplicity of the server design, tracing the execution path through
the server when a connection is established is very simple:

When the server receives a command on a connection, it creates a
\verb|server_msg_handler| object and delegates the task of handling the request
by calling the \verb|server_msg_handler.handle| function. This function checks
what command the client sent and calls different functions in the class
depending on the result.  Each of these functions perform some sanity checking
on the request and responds in an appropriate way after consulting the database.

The \verb|server_msg_handler| class is a subclass of the \verb|msg_handler|
class which contains some helper functions common to both the client and the
server. These helper functions include \verb|write_parameter_int|,
\verb|write_int| and \verb|write_string|, which write strings and integers in
the manner specified by the protocol.

\section{Server, memory only database}
\label{sec:smemdb}

\subsection{Memory Database}
\label{ssec:mem_db}
The memory database stores data only in primary memory. It uses two maps, one to connect a news group
to a number of articles and one to connect the news group ids to the actual news groups. The latter
map was not technically necessary; it is mearly an optimization since the database functions take
news group id as arguments. 

The map containing the articles maps a news group to a vector containing article objects. Since newer
articles will always be stored later in the vector, it will always be sorted by id. The
implementation does not take advantage of this, though. 

The memory database inherits from the virtual class \texttt{Database} to make sure it uses a common 
interface with other database implementations. It has no public functions except for the ones inherited
from the interface.


\section{Server with Disk Backed Database}
\label{sec:sdiskdb}

See \ref{sec:smemdb}. Another database class are employed to save the
database to disk \ref{ssec:mem_db}.

\subsection{File Database}
\label{ssec:file_db}
The file database stores all data to files and directories directly. Each news group is represented
by a folder named by the news group id. The news group name is stored in a specific file called ".ngname.txt",
which is ignored when searching for articles. The articles are stored as files in the news group folders, 
also named by their id. The title, author and contents of the articles are separated by a specific separator
string, chosen in such a way that it will not appear in any realistic article. For a full scale implementation, a
slightly more sophisticated strategy could be used. The file database does not keep anything in the primary memory, 
which makes sure every change is instantly reflected on the hard disk. 

Reading and writing to folders are implemented with C functions like \texttt{opendir, readdir} and \texttt{closedir}.
Reading and writing to files are implemented with C++ file streams. 
%Something like the Boost filesystem library could be used to make the style more C++ compliant.

Like the memory database, it inherits from the virtual class \texttt{Database} to make sure it uses a common 
interface with other database implementations. It has no public functions except for the ones inherited
from the interface.


\section{Client}
\label{sec:client}
%% TODO: Subsections for classes used. Ref. to already described classes.

\end{document}



